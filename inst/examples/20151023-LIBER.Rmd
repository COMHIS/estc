# LIBER publication materials 10/2015

```{r 20151023LIBER-1, echo=FALSE, message=FALSE, cache=FALSE, fig.height=5, fig.width=6}
library(ggplot2)
library(dplyr)
theme_set(theme_bw(50))
selected.authors <- c("prynne, william (1600-1669)", "defoe, daniel (1661-1731)", "hume, david (1711-1776)", "hume, david (1560-1630)")
top <- names(rev(sort(table(df$author_unique))))[1:20]
top <- c(top, "hume, david (1560-1630)")
top <- setdiff(top, "caesar, julius (-100- -44)")
dfs <- filter(df, author_unique %in% top)
p <- top_plot(dfs, "author_unique", ntop = 30, highlight = selected.authors)
p <- p + guides(fill = "none")
p <- p + ylab("Title count")
p <- p + scale_fill_manual(values = c("darkgray", "black"))
print(p)
```

```{r 20151023LIBER-2, echo=FALSE, message=FALSE, cache=FALSE, fig.height=5, fig.width=7}
theme_set(theme_bw(20))
dfa <- dfs[, c("author_name", "author_unique", "author_birth", "author_death")]
dfa <- dfa[!duplicated(dfa), ]
#dfa <- dfa[match(names(a), dfa$author_name),]
dfa <- arrange(dfa, author_birth)
# Order authors by birth year
dfa$author_name <- factor(dfa$author_name, levels = unique(dfa$author_name))
dfa$index <- sample(factor(1:nrow(dfa)))
dfa$fill <- rep("black", nrow(dfa))
dfa$fill[dfa$author_unique %in% selected.authors] <- "red"

p <- ggplot(dfa)
p <- p + geom_segment(aes(y = author_name, yend = author_name, x = author_birth, xend = author_death, color = fill), size = 2) 
p <- p + theme(axis.text.y = element_text(size = 14))
p <- p + xlab("Author life span (year)") + ylab("")
p <- p + guides(color = FALSE)
p <- p + scale_color_manual(values = c("darkgray", "black"))
print(p)
```


```{r 20151023LIBER-3, echo=FALSE, message=FALSE, cache=FALSE, fig.height=4, fig.width=10}
theme_set(theme_bw(20))
dfs <- df %>%
         filter(author_unique %in% selected.authors) %>%
	 group_by(author_unique, publication_year) %>%
	 tally() %>%
	 arrange(publication_year)
theme_set(theme_bw(20))

# Barplot version
p2 <- ggplot(dfs, aes(x = publication_year, y = n, fill = author_unique)) +
       geom_bar(stat = "identity", position = "stack") +
       xlab("Publication Year") +
       ylab("Title Count")       
p2
```


```{r 20151023LIBER-3b, echo=FALSE, message=FALSE, cache=FALSE, fig.height=7, fig.width=7}
library(tidyr)
dfs <- df
# 2long/2fo/2small -> folio; 8vo -> octavo
dfs$gatherings <- harmonize_names(dfs$gatherings, gatherings_table(),
	       	  		from = "Standard", to = "Name")$name

top <- names(rev(sort(table(df$author_unique))))[1:20]
top <- c(top, "hume, david (1560-1630)")
top <- setdiff(top, "caesar, julius (-100- -44)")

dfs <- dfs %>% filter(author_unique %in% top &
	        gatherings %in% c("folio", "octavo")) %>%
	 group_by(author_unique, gatherings) %>%
	 tally() %>%
	 spread(gatherings, n)
dfs$highlight <- dfs$author_unique %in% c(selected.authors, "burke, edmund (1729-1797)")
dfs[is.na(dfs)] <- 0
dfs[dfs$author_unique == "hume, david (1560-1630)","highlight"] <- FALSE
dfs$size <- 2 + 1*as.numeric(dfs$highlight)

theme_set(theme_bw(20))
p <- ggplot(dfs, aes(x = folio, y = octavo)) +
       geom_text(aes(label = author_unique, color = highlight, size = size)) +       
       xlab("Folio") + ylab("Octavo") +
       guides(color = "none", size = "none") + 
       scale_color_manual(values = c("darkgray", "black")) +
       xlim(-20,max(dfs$folio) + 8) +
       scale_size(range = c(4,7))       
print(p)
```


```{r 20151023LIBER-4, echo=FALSE, message=FALSE, cache=FALSE, fig.height=5, fig.width=6}
theme_set(theme_bw(20))
dfs <- df
#dfs$gatherings <- harmonize_names(dfs$gatherings, gatherings_table(),
#	       	  		  from = "Standard", to = "Name")$name
#dfs <- dfs %>% filter(gatherings %in% c("folio", "octavo") &
dfs <- dfs %>% filter(as.character(author_unique) %in% top) %>%
       	        group_by(author_unique) %>%
	        summarize(titles = n(),
	        paper = sum(paper.consumption.km2, na.rm = T))
dfs$highlight <- rep("darkgray", nrow(dfs))
dfs$highlight[dfs$author_unique %in% selected.authors] <- "black"
p <- ggplot(dfs, aes(x = titles, y = paper, color = highlight)) 
p <- p + geom_text(aes(label = author_unique)) 
p <- p + scale_color_manual(values = c("darkgray", "black")) 
p <- p + guides(color = "none") 
p <- p + xlim(c(-50, 180)) 
p <- p + xlab("Title Count") 
p <- p + ylab("Paper consumption (km2)")
       
print(p)	 
```




```{r 20151023LIBER-5, echo=FALSE, message=FALSE, cache=FALSE, fig.height=5, fig.width=5}
theme_set(theme_bw(20))
dfs <- df %>% filter(author_gender == "female")
dfs <- dfs[-c(grep("jean", dfs$author_unique), grep("pierre", dfs$author_unique)),]
p <- top_plot(dfs, "author_unique", ntop = 20)
p <- p + scale_fill_manual(values = "black")
p <- p + guides(fill = "none")
p <- p + ylab("Title Count")
print(p)	 
```



```{r 20151023LIBER-6, echo=FALSE, message=FALSE, cache=FALSE, fig.height=5, fig.width=5}
theme_set(theme_bw(20))
p <- top_plot(df, "publication_place", ntop = 20)
p <- p + scale_fill_manual(values = "black")
p <- p + guides(fill = "none")
p <- p + ylab("Title Count")
p <- p + scale_y_log10()
print(p)	 
```



```{r 20151023LIBER-8, echo=FALSE, message=FALSE, cache=FALSE, fig.height=6, fig.width=8}
theme_set(theme_bw(20))
top <- names(rev(sort(table(df$publication_place))))[1:50]
dfs <- df %>% filter(publication_place %in% top) %>% group_by(publication_place) %>% summarize(titles = n(), paper = sum(paper.consumption.km2, na.rm = T))
dfs$country <- get_country(dfs$publication_place)$country
dfs$usa <- dfs$country == "USA"
p <- ggplot(dfs, aes(x = log10(titles), y = log10(paper)))
p <- p + geom_text(aes(label = publication_place, color = usa), size = 5)
p <- p + xlim(c(1.2, log10(max(na.omit(dfs$titles[!is.infinite(dfs$titles)])))))
p <- p + xlab("Title Count") + ylab("Paper consumption (km2)")
p <- p + scale_color_manual(values = c("darkgray", "black"))       
print(p)	 
```




```{r 20151023LIBER-10a, echo=FALSE, message=FALSE, cache=FALSE, fig.height=6, fig.width=7}
library(sorvi)
dfs <- df %>% filter(publication_year >= 1470) %>% 
         group_by(publication_year) %>%
         summarize(titles = n(), paper = sum(paper.consumption.km2, na.rm = T))
	 
p1 <- regression_plot(titles ~ publication_year, data = dfs)
p1 <- p1 + xlab("Publication Year") + ylab("Title Count") 
p1 <- p1 + theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15))
p1 <- p1 + theme(axis.title.x = element_text(size = 15), axis.title.y = element_text(size = 15))
print(p1)
```

```{r 20151023LIBER-10b, echo=FALSE, message=FALSE, cache=FALSE, fig.height=6, fig.width=7}
p2 <- regression_plot(paper ~ publication_year, data = dfs) +
       xlab("Publication Year") +
       ylab("Paper Consumption (km2)") 
p2 <- p2 + theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15))
p2 <- p2 + theme(axis.title.x = element_text(size = 15), axis.title.y = element_text(size = 15))

print(p2)
```


```{r 20151023LIBER-11, echo=FALSE, message=FALSE, cache=FALSE, fig.height=4, fig.width=8}
theme_set(theme_bw(20))
library(sorvi)
dfs <- df %>% filter(publication_year >= 1470) %>% 
         group_by(publication_year) %>%
         summarize(paper.per.doc = mean(paper.consumption.km2, na.rm = T))

p <- ggplot(dfs, aes(y = paper.per.doc, x = publication_year)) +
       geom_line() + geom_point() +
       #geom_bar(stat = "identity") +
       xlab("Publication Year") + ylab("Paper per document")
       
print(p)
```

## How does publishing change ?

```{r 20151023LIBER-12, echo=FALSE, message=FALSE, cache=FALSE, fig.height=6, fig.width=7}
df$document.type <- rep(NA, nrow(df))
df$document.type[df$pagecount > 32] <- "book"
df$document.type[df$pagecount <= 32] <- "pamphlet"
df$document.type <- factor(df$document.type)

df2 <- df %>% group_by(publication_year, document.type) %>% summarize(paper.consumption.km2 = sum(paper.consumption.km2, na.rm = TRUE), n = n()) 
p <- ggplot(df2, aes(x = publication_year, y = paper.consumption.km2, group = document.type, color = document.type))
p <- p + geom_point()
p <- p + geom_smooth(method = "loess")
p <- p + ggtitle("Paper consumption per document document.type")
p <- p + xlab("Year")
p <- p + ylab("Paper consumption (km2)")
print(p)
```