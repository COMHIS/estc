---
title: "Page count summary"
author: "Leo Lahti"
date: "30/05/2015"
output: markdown_document
---


## Page counts

Page count: distribution of document sizes

```{r pagecountstat, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=5}

  theme_set(theme_bw(15))

  # Single-volume docs
  dff <- filter(df, document.volcount == 1 & is.na(document.volnumber))

  dff2 <- dff %>% group_by(document.dimension.gatherings.estimated, 
		    	     document.pages.total) %>%
			     tally()

  dff3 <- dff %>% group_by(document.dimension.gatherings.estimated) %>%
		    summarize(mean = mean(document.pages.total, na.rm = T), 
		              median = median(document.pages.total, na.rm = T))

  p <- ggplot(dff2, aes(y = document.dimension.gatherings.estimated, x = document.pages.total)) 
  p <- p + geom_point(aes(size = n))
  p <- p + geom_point(data = dff3, aes(y = document.dimension.gatherings.estimated, x = mean), col = "red", size = 3)
  p <- p + geom_point(data = dff3, aes(y = document.dimension.gatherings.estimated, x = median), col = "blue", size = 3)
  p <- p + scale_x_log10(breaks = c(1, 10, 100, 1000))
  p <- p + xlab("Total page count (blue: median; red: mean)")
  p <- p + ylab("Document size")
  p <- p + ggtitle(paste("Pages: single-volume documents (n=", nrow(dff), ")", sep = ""))
  p1 <- p 

  # Multi-volume docs
  theme_set(theme_bw(15))
  dff <- filter(df, 
 	   (document.volcount > 1 | 
	   (document.items == 1 & !is.na(document.volnumber)))
	   #document.pages.total > 10
	   )
  dff2 <- dff %>% group_by(document.dimension.gatherings.estimated, 
		    	     document.pages.total) %>%
		    	     tally()

  dff3 <- dff %>% group_by(document.dimension.gatherings.estimated) %>%
		    summarize(mean = mean(document.pages.total, na.rm = T), 
		     median = median(document.pages.total, na.rm = T))

  p <- ggplot(dff2, aes(y = document.dimension.gatherings.estimated, x = document.pages.total)) 
  p <- p + geom_point(aes(size = n))
  p <- p + geom_point(data = dff3, aes(y = document.dimension.gatherings.estimated, x = mean), col = "red", size = 3)
  p <- p + geom_point(data = dff3, aes(y = document.dimension.gatherings.estimated, x = median), col = "blue", size = 3)
  p <- p + scale_x_log10(breaks = c(1, 10, 100, 1000))
  p <- p + xlab("Total page count (blue: median; red: mean)")
  p <- p + ylab("Document size")
  p <- p + ggtitle(paste("Pages: multi-volume documents (n=", nrow(dff), ")", sep = ""))
  p2 <- p 

library(gridExtra)
grid.arrange(p1, p2, nrow = 1)
```


## Documents with missing pages over years 

```{r missingpages, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=8, fig.height=4}
library(dplyr)
df2 <- df %>% group_by(publication.decade, document.dimension.gatherings.estimated) %>% summarize(na = sum(is.na(document.pages.total.orig) | (!document.pages.total.orig == document.pages.total)))
df2$na[df2$na == 0] <- NA
library(ggplot2)
theme_set(theme_bw(15))
p <- ggplot(df2, aes(x = publication.decade, y = document.dimension.gatherings.estimated, size = na))
p <- p + geom_point()
p <- p + xlim(c(min(na.omit(df$publication.decade)), 1800))
p <- p + ggtitle(paste("Documents with missing page counts (original; n=", sum(na.omit(df2$na)), ")", sep = ""))
p <- p + xlab("Publication decade")
p <- p + ylab("Document dimension (estimated)")
print(p)

library(dplyr)
df2b <- df %>% group_by(publication.decade, document.dimension.gatherings.estimated) %>% summarize(na = sum(is.na(document.pages.total)))
df2b$na[df2b$na == 0] <- NA
library(ggplot2)
theme_set(theme_bw(15))
p <- ggplot(df2b, aes(x = publication.decade, y = document.dimension.gatherings.estimated, size = na))
p <- p + geom_point()
p <- p + xlim(c(min(na.omit(df$publication.decade)), 1800))
p <- p + ggtitle(paste("Documents with missing page counts (after adding averages; n=", sum(na.omit(df2b$na)), ")", sep = ""))
p <- p + xlab("Publication decade")
p <- p + ylab("Document dimension (estimated)")
print(p)
```


## Estimated paper consumption

Note: there are `r length(which(is.na(df$document.dimension.cm2) & (!is.na(df$document.dimension.gatherings.original) | !is.na(df$document.dimension.width.original) | !is.na(df$document.dimension.height.original))))` documents that have some dimensions information but sheet area information could not be calculated for some reason. 

```{r paperconsumption, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=6}
library(dplyr)
library(ggplot2)
df <- df.preprocessed
df2 <- df %>% group_by(publication.year) %>% summarize(paper.consumption.km2 = sum(paper.consumption.km2, na.rm = TRUE), n = n()) 
library(sorvi)
p <- regression_plot(paper.consumption.km2 ~ publication.year, df2) 
p <- p + ggtitle("Total annual paper consumption")
p <- p + xlab("Year")
p <- p + ylab("Paper consumption (km2)")
print(p)

# Year vs paper with text
#p <- ggplot(df2, aes(y = paper.consumption.km2, x = publication.year))
#p <- p + geom_text(aes(label = publication.year))
#p <- p + ggtitle("Total annual paper consumption")
#p <- p + xlab("Year")
#p <- p + ylab("Paper consumption (km2)")
#print(p)

p <- regression_plot(n ~ publication.year, df2) 
p <- p + ggtitle("Total annual documents")
p <- p + xlab("Year")
p <- p + ylab("Documents (n)")
print(p)
```

```{r paperconsumption2b, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=8, fig.height=5}
df <- df.preprocessed
df2 <- df %>% group_by(publication.year, document.dimension.gatherings.estimated) %>% summarize(paper.consumption.km2 = sum(paper.consumption.km2, na.rm = TRUE), n = n()) 
df2 <- filter(df2, document.dimension.gatherings.estimated %in% names(which(table(df2$document.dimension.gatherings.estimated) >= 50)))
p <- ggplot(df2, aes(y = paper.consumption.km2, x = publication.year, group = document.dimension.gatherings.estimated, color = document.dimension.gatherings.estimated))
p <- p + geom_point()
#p <- p + geom_line()
#p <- p + scale_y_log10()
p <- p + geom_smooth(method = "loess", size = 1)
p <- p + ggtitle("Annual paper consumption by gatherings")
p <- p + xlab("Year")
p <- p + ylab("Paper consumption (km2)")
p <- p + scale_color_discrete(guide = guide_legend(title = "Doc. Size"))
print(p)

p <- ggplot(df2, aes(y = n, x = publication.year, group = document.dimension.gatherings.estimated, color = document.dimension.gatherings.estimated))
p <- p + geom_point()
#p <- p + geom_line()
#p <- p + scale_y_log10()
p <- p + geom_smooth(method = "loess", size = 1)
p <- p + ggtitle("Annual title count by gatherings")
p <- p + xlab("Year")
p <- p + ylab("Documents (n)")
print(p)




```{r pagecounts-gatherings-relab, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=8, fig.height=5}
df <- df.preprocessed
df2 <- df %>% group_by(publication.year, document.dimension.gatherings.estimated) %>% summarize(paper.consumption.km2 = sum(paper.consumption.km2, na.rm = TRUE), n = n()) 
df2 <- filter(df2, document.dimension.gatherings.estimated %in% names(which(table(df2$document.dimension.gatherings.estimated) >= 50)))

p <- ggplot(df2, aes(x = publication.year, fill = document.dimension.gatherings.estimated)) + geom_bar(position = "stack", stat = "bin")
p <- p + ggtitle("Gatherings counts over time")
print(p)

p <- ggplot(df2, aes(x = publication.year, fill = document.dimension.gatherings.estimated)) + geom_bar(position = "fill")
p <- p + ggtitle("Gatherings proportions over time")
print(p)    
```

p <- ggplot(df2, aes(y = n, x = publication.year, group = document.dimension.gatherings.estimated, color = document.dimension.gatherings.estimated))
p <- p + geom_point()
#p <- p + geom_line()
#p <- p + scale_y_log10()
p <- p + geom_smooth(method = "loess", size = 1)
p <- p + ggtitle("Annual title count by gatherings")
p <- p + xlab("Year")
p <- p + ylab("Documents (n)")
print(p)
```

```{r paperconsumption2, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=13, fig.height=6}
df <- df.preprocessed
df2 <- df %>% group_by(publication.year) %>% summarize(paper.consumption.km2 = sum(paper.consumption.km2, na.rm = TRUE), n = n()) 
p <- ggplot(df2, aes(x = publication.year, y = paper.consumption.km2/n))
p <- p + geom_point()
p <- p + geom_line()
p <- p + ggtitle("Average paper consumption per document")
p <- p + xlab("Year")
p <- p + ylab("Average paper consumption per document (km2)")
print(p)
```



## Pamphlets vs. Books

```{r doctypes, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=13, fig.height=6}
library(ggplot2)
library(dplyr)
df <- df.preprocessed
df$document.type <- rep(NA, nrow(df))
df$document.type[df$document.pages.total > 32] <- "book"
df$document.type[df$document.pages.total <= 32] <- "pamphlet"
df$document.type <- factor(df$document.type)

df2 <- df %>% group_by(publication.year, document.type) %>% summarize(paper.consumption.km2 = sum(paper.consumption.km2, na.rm = TRUE), n = n()) 
p <- ggplot(df2, aes(x = publication.year, y = paper.consumption.km2, group = document.type, color = document.type))
p <- p + geom_point()
p <- p + geom_smooth(method = "loess")
p <- p + ggtitle("Paper consumption per document type")
p <- p + xlab("Year")
p <- p + ylab("Paper consumption (km2)")
print(p)

p <- ggplot(df2, aes(x = publication.year, y = n, group = document.type, color = document.type))
p <- p + geom_point()
p <- p + geom_smooth(method = "loess")
p <- p + ggtitle("Documents per document type")
p <- p + xlab("Year")
p <- p + ylab("Documents (n)")
print(p)
```


```{r doctypes2, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=13, fig.height=6}
df <- mutate(df, document.length = cut(document.pages.total, c(0, 32, 72, 148, 250, 450, 800, 2000, 5000, Inf)))

df2 <- df %>% group_by(publication.decade, document.length) %>% summarize(paper.consumption.km2 = sum(paper.consumption.km2, na.rm = TRUE), n = n()) 
p <- ggplot(df2, aes(x = publication.decade, y = paper.consumption.km2, group = document.length, color = document.length))
p <- p + geom_point()
p <- p + geom_smooth(method = "loess", size = 1)
p <- p + ggtitle("Paper consumption per document type")
p <- p + xlab("Decade")
p <- p + ylab("Paper consumption (km2)")
print(p)

p <- ggplot(df2, aes(x = publication.decade, y = n, group = document.length, color = document.length))
p <- p + geom_point()
p <- p + geom_smooth(method = "loess", size = 1)
p <- p + ggtitle("Documents per document type")
p <- p + xlab("Decade")
p <- p + ylab("Documents (n)")
print(p)
```


## Top authors

```{r topauth, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=13, fig.height=6}
df <- df.preprocessed
top.authors <- names(rev(sort(table(df.preprocessed$author.unique))))[1:10]
df2 <- df %>% filter(author.unique %in% top.authors) %>% group_by(publication.year, author.unique) %>% summarize(paper.consumption.km2 = sum(paper.consumption.km2, na.rm = TRUE), n = n()) 

p <- ggplot(df2, aes(x = publication.year, y = paper.consumption.km2, group = author.unique, color = author.unique))
p <- p + geom_point()
p <- p + geom_line()
#p <- p + geom_smooth(method = "loess", size = 1)
p <- p + ggtitle("Paper consumption per author")
p <- p + xlab("Year")
p <- p + ylab("Paper consumption (km2)")
print(p)

p <- ggplot(df2, aes(x = publication.year, y = n, group = author.unique, color = author.unique))
p <- p + geom_point()
p <- p + geom_line()
#p <- p + geom_smooth(method = "loess", size = 1)
p <- p + ggtitle("Documents per author")
p <- p + xlab("Year")
p <- p + ylab("Documents (n)")
print(p)
```




## Nature of the documents over time

Estimated paper consumption by document size

```{r 20150611paris-paper6, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=13, fig.height=7}
df2 <- df %>% group_by(publication.year, document.dimension.gatherings.estimated) %>% summarize(paper.consumption.km2 = sum(paper.consumption.km2, na.rm = TRUE), n = n()) 
df2 <- filter(df2, document.dimension.gatherings.estimated %in% names(which(table(df2$document.dimension.gatherings.estimated) >= 50)))
p <- ggplot(df2, aes(y = paper.consumption.km2, x = publication.year, group = document.dimension.gatherings.estimated, color = document.dimension.gatherings.estimated))
p <- p + geom_point()
p <- p + geom_smooth(method = "loess", size = 1)
p <- p + ggtitle("Annual paper consumption by gatherings")
p <- p + xlab("Year")
p <- p + ylab("Paper consumption (km2)")
print(p)
```


Gatherings height: does it change over time (1600's)? How increased printing activity is related to book size trends? Instead, we could use area (height x width), or simply calculate median over time but let's discuss this later.

```{r pagecounts-gatsize, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=10, fig.height=7}
df <- df.preprocessed
for (g in c("1to", "2fo", "4to", "8vo")) {
  df2 <- filter(df, publication.year >=1600 & publication.year < 1700 &
       		  !is.na(document.dimension.gatherings.original) &
		  !is.na(document.dimension.height.original) &
		  document.dimension.gatherings.original == g) %>%
       group_by(publication.year, document.dimension.height.original) %>%
       tally()

  p <- ggplot(df2, aes(x = publication.year, y = document.dimension.height.original)) + geom_point(aes(size = n)) 
  p <- p + ggtitle(paste(g, "heights over time"))
  print(p)
}
```


Page counts: does it change over time (1600's)? Also suggested we could calculate some kind of factor for each time period based on this ? In principle, we could calculate this separately for any given publication place as well but leẗ́s discuss this later. Would help to specify some specific places of interest.

```{r pagecounts-gatsize2, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=10, fig.height=7}
df <- df.preprocessed
for (g in c("1to", "2fo", "4to", "8vo")) {
  df2 <- filter(df, publication.year >=1600 & publication.year < 1700 &
       		  !is.na(document.dimension.gatherings.original) &
		  !is.na(document.pages.total.orig) &
		  document.dimension.gatherings.original == g)
  df3 <- df2 %>%
       group_by(publication.year, document.pages.total.orig) %>%
       tally()

  p <- ggplot(df3, aes(x = publication.year, y = document.pages.total.orig)) + geom_point(aes(size = n))
  p <- p + geom_smooth(data = df2, aes(x = publication.year, y = document.pages.total.orig))
  p <- p + ggtitle(paste(g, "pagecount over time"))
  print(p)
}
```


Same for documents that have a sufficient number of pages:

```{r pagecounts-gatsize3, echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=10, fig.height=7}
df <- df.preprocessed
minpages <- 60
for (g in c("1to", "2fo", "4to", "8vo")) {
  df2 <- filter(df, document.pages.total >= minpages &
       		  !is.na(document.dimension.gatherings.original) &
		  !is.na(document.pages.total.orig) &
		  document.dimension.gatherings.original == g)
  df3 <- df2 %>%
       group_by(publication.year, document.pages.total.orig) %>%
       tally()

  p <- ggplot(df3, aes(x = publication.year, y = document.pages.total.orig)) + geom_point(aes(size = n))
  p <- p + geom_smooth(data = df2, aes(x = publication.year, y = document.pages.total.orig))
  p <- p + ggtitle(paste(g, "pagecount over time (books with over", minpages, "pages)"))
  print(p)
}
```
